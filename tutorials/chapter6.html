<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>GameFinal Engine</title>
		<link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
		<link href="html/main.css" type="text/css" rel="stylesheet" />
		<!--<link href="html/markdown.css" type="text/css" ref="stylesheet" />-->
		<script src="http://code.jquery.com/jquery.js"></script>
		<script src="../bootstrap/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="html/main.js"></script>
		<link href="html/prism.css" rel="stylesheet" />
		<script src="html/prism.js"></script>
	</head>
	<body>

	<div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
          <div class="container">
              <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
              </button>
              <a class="brand" href="../index.html">GameFinal</a>
              <div class="nav-collapse collapse">
                  <ul class="nav">
                      <li class="">
                          <a href="../index.html">Home</a>
                      </li>
                      <li class="">
                          <a href="../download.html">Download</a>
                      </li>
                      <li class="dropdown">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
                          <ul class="dropdown-menu">
                              <li><a href="chapter1.html">01 Configuration</a></li>
                              <li><a href="chapter2.html">02 First Program</a></li>
                              <li><a href="chapter3.html">03 Material</a></li>
                              <li><a href="chapter4.html">04 Camera</a></li>
                              <li><a href="chapter5.html">05 Lighting</a></li>
                              <li><a href="chapter6.html">06 Model</a></li>
                              <li><a href="chapter7.html">07 Shader</a></li>
                              <li><a href="chapter8.html">08 Terrain</a></li>
                              <li><a href="chapter9.html">09 Instancing</a></li>
                              <li><a href="chapter10.html">10 Havok</a></li>
                              <li><a href="chapter11.html">11 Post Effect</a></li>
                              <li><a href="chapter12.html">12 Compute Shader</a></li>
                          </ul>
                      </li>
                      <li class="">
                          <a href="../about.html">Contact</a>
                      </li>
                  </ul>
              </div>
          </div>
      </div>
    </div>
	<div class="main_div">
		<div class="tutorial_nav">
			<p style="color: #6F0101; font-weight: bold; font-size: 1.4em; padding: 5px;">Tutorials</p>
			<div class="tutorial_link"><a href="chapter1.html">01 Configuration</a></div>
			<div class="tutorial_link"><a href="chapter2.html">02 First Program</a></div>
			<div class="tutorial_link"><a href="chapter3.html">03 Material</a></div>
			<div class="tutorial_link"><a href="chapter4.html">04 Camera</a></div>
			<div class="tutorial_link"><a href="chapter5.html">05 Lighting</a></div>
			<div class="tutorial_link"><a href="chapter6.html" class="current_tutorial_link">06 Model</a></div>
			<div class="tutorial_link"><a href="chapter7.html">07 Shader</a></div>
			<div class="tutorial_link"><a href="chapter8.html">08 Terrain</a></div>
			<div class="tutorial_link"><a href="chapter9.html">09 Instancing</a></div>
			<div class="tutorial_link"><a href="chapter10.html">10 Havok</a></div>
			<div class="tutorial_link"><a href="chapter11.html">11 Post Effect</a></div>
			<div class="tutorial_link"><a href="chapter12.html">12 Compute Shader</a></div>
		</div>
		<div class="tutorial_content">
<h1>Model</h1>
<p>GameFinal has its own mesh format with the suffix <code>.mesh</code>. The engine provides a command line tool that enables you to convert other formats to &quot;.mesh&quot; file.</p>
<p>In this demo, we have prepared a obj file,'apartmentB.obj'. Now, let's convert this object file to a &quot;.mesh&quot; file. 
Go to the directory that contains the &quot;MeshConverter.exe&quot;, then copy the obj file into this folder (You may need to copy the &quot;mtl&quot; file as well, &quot;apartmentB.mtl&quot;).</p>
<p>Open your command window and go to this folder, then press the following command:</p>
<pre><code>MeshConverter.exe &quot;apartmentB.obj&quot; -f &quot;p|n|tex&quot;
</code></pre>

<p>The string &quot;apartmentB.obj&quot; is the name of the model file. The string &quot;p|n|tex&quot; following &quot;-f&quot; specifies the vertex's format. &quot;p|n|tex&quot; indicates that each vertex includes position(p), normal vector(n) and texture coordinates(tex). If you want to add another tangent vector to each vertex, you could set the format as &quot;p|n|t|tex&quot;.Except for &quot;obj&quot; file, MeshGenerate also supports 3ds, dae, md2, md3, ms3d, X file and so on.</p>
<p>If the program doesn't show any error message, it means you converted the file successfully:</p>
<p><img src="https://raw.githubusercontent.com/woyaofacai/GameFinal/master/Tutorials/img/05-01.png" /></p>
<p>You might have found that except for the mesh file &quot;apartmentB.mesh&quot;, several other files were generated, including a shader file &quot;apartmentB.hlsl&quot;, a pipeline file &quot;apartmentB.pipeline.xml&quot; and a material file &quot;apartmentB.material.xml&quot;. We need copy all these files into the &quot;./media&quot; folder. We also copy texture file &quot;apartmentB_tex.bmp&quot; into the &quot;./media&quot; folder.</p>
<p>The C++ code that sets up the scene is shown here:</p>
<pre><code class="language-cpp">ISceneManager* setupScene(IDevice* device) {

    // create scene manager
    ISceneManager* smgr = device-&gt;createSceneManager();

    // get mesh manager
    IMeshManager* meshManager = IMeshManager::getInstance();

    // set up ground.
    ISimpleMesh* groundMesh = meshManager-&gt;createPlaneMesh(&quot;ground&quot;, 100.0f, 100.0f, 10, 10, 50, 50);
    IMeshNode* groundNode = smgr-&gt;addMeshNode(groundMesh, &quot;ground_material&quot;, nullptr, true);

    IModelMesh* apartmentMesh = meshManager-&gt;getModelMesh(&quot;apartmentB.mesh&quot;);
    IMeshNode* apartmentNode = smgr-&gt;addModelMeshNode(apartmentMesh, nullptr, true, XMFLOAT3(0, 0, 0));

    // add directional light
    ILightNode* light = smgr-&gt;addDirectionalLight(1, nullptr, XMFLOAT3(5.0f, -5.0f, 2.0f));
    light-&gt;setSpecular(XMFLOAT4(1.0f, 1.0, 1.0f, 32.0f));
    light-&gt;setDiffuse(XMFLOAT4(0.8f, 0.8f, 0.8f, 1.0f));
    light-&gt;enableShadow(true);

    apartmentNode-&gt;addShadow(1);

    // create a camera node
    ICameraNode* camera = smgr-&gt;addCameraNode(1, nullptr, XMFLOAT3(15.0f, 20.0f, -25.0f), 
            XMFLOAT3(0, 1.0f, 0.0f), XMFLOAT3(0, 1.0f, 0));
    camera-&gt;setShadowRange(100.0f);

    // set ambient in the environment.
    smgr-&gt;setAmbient(XMFLOAT4(0.8f, 0.8f, 0.8f, 1.0f));

    return smgr;
}
</code></pre>

<p>In C++ code, we can get a model mesh by calling <code>IMeshManager::getModelMesh</code>, then we call the <code>ISceneManager::addModelMeshNode</code> to add a model node into the scene at the position (0, 0, 0):</p>
<pre><code class="language-cpp">IModelMesh* apartmentMesh = meshManager-&gt;getModelMesh(&quot;apartmentB.mesh&quot;);
IMeshNode* apartmentNode = smgr-&gt;addModelMeshNode(apartmentMesh, nullptr, true, XMFLOAT3(0, 0, 0));
</code></pre>

<p>We run the program, then we have already drawn the model on the screen successfully:</p>
<p><img src="https://raw.githubusercontent.com/woyaofacai/GameFinal/master/Tutorials/img/05-02.png" /></p>
<h2>Lighting the Model</h2>
<p>Now the model is not affected by the light; so we have to change the material file that created by the &quot;MeshConverter.exe&quot;. </p>
<p>Open the &quot;apartmentB.material.xml&quot;, then change the pipelines of &quot;apartmentB/material_01&quot; like this:</p>
<pre><code class="language-markup">&lt;material name=&quot;apartmentB/material_01&quot;&gt;
    &lt;attributes&gt;
        &lt;attribute name=&quot;ambient&quot; value=&quot;0.200000, 0.200000, 0.200000, 1.000000&quot;/&gt;
        &lt;attribute name=&quot;diffuse&quot; value=&quot;1.000000, 1.000000, 1.000000, 1.000000&quot;/&gt;
        &lt;attribute name=&quot;specular&quot; value=&quot;0.200000, 0.200000, 0.200000, 1.000000&quot;/&gt;
        &lt;attribute name=&quot;emissive&quot; value=&quot;0.000000, 0.000000, 0.000000, 1.000000&quot;/&gt;
    &lt;/attributes&gt;
    &lt;pipelines&gt;
        &lt;pipeline name=&quot;gf/model_shadow_dirlight&quot;/&gt;
        &lt;pipeline name=&quot;gf/model_shadow_map&quot; usage=&quot;shadow_map&quot;/&gt;
    &lt;/pipelines&gt;
    &lt;textures&gt;
        &lt;texture name=&quot;apartmentB_tex.bmp&quot;/&gt;
    &lt;/textures&gt;
&lt;/material&gt;
</code></pre>

<p>Both <code>gf/model_shadow_dirlight</code> and <code>gf/model_shadow_map</code> are built in pipelines that render a model under a directional light with shadow. Besides, we could change the <code>attributes</code> here: in this demo, we change the &quot;ambient&quot; to (0.3, 0.3, 0.3, 1), and set its emissive value to all zeros.</p>
<p>Then run the program, we have found that the building is lighted by the directional light now:</p>
<p><img src="https://raw.githubusercontent.com/woyaofacai/GameFinal/master/Tutorials/img/05-03.png" /></p>
<h2>Skeleton Animation</h2>
<p>We can create meshes that contain skeleton animation in the same way as static mesh. When the mesh generator detects the original model has skeleton, it will put all the skeletons and animations into the &quot;.mesh&quot; file. </p>
<p>However, in order to get a mesh with skeletons, you have to call <code>IMeshManager::getAnimatedMesh</code> method instead of <code>getModelMesh</code> method. To create animated mesh node, you need to <code>ISceneManager::addAnimatedMeshNode</code> method, just like this:</p>
<pre><code class="language-cpp">IAnimatedMesh* animMesh = meshManager-&gt;getAnimatedMesh(&quot;lxq.mesh&quot;);
IAnimatedMeshNode* animNode = smgr-&gt;addAnimatedMeshNode(animMesh, nullptr, false, XMFLOAT3(0, 0, -10.0f),
    XMFLOAT3(0, 0, 0), XMFLOAT3(0.1f, 0.1f, 0.1f));
</code></pre>

<p>In addition, we have to animate this object manually by calling <code>IAnimatedMeshNode::addTime</code> method every frame. You pass in a time value as its parameter; in this way, we can control the speed of the animation:</p>
<pre><code class="language-cpp">animNode-&gt;addTime(dt * 3000.0f);
</code></pre>

<p>The final effect:</p>
<p><img src="https://github.com/woyaofacai/GameFinal/blob/master/Tutorials/img/05-04.png?raw=true" /></p>

	</div>

	</div>
</body>
</html>